<body id=b style=margin:0>
<canvas id=a></canvas>
<script>
d = document;
c = a.getContext("2d");
a.width = innerWidth;
a.height = innerHeight;

con = console;

sw = innerWidth;
sh = innerHeight;
objs = 250; // no of objects
fric = .99;
v = [];

r = (min, max) => min + Math.random() * (max - min);
abs = i => Math.abs(i)

for (i = 0; i++ < objs;) {
	coin = ~~r(3,6)
	f = .5
	v[i] = {
		mx: r(-f,f),
		my: r(-f,f),
		mmx: 0,
		mmy: 0,
		r: coin ** 2,
		x: r(0, sw),
		y: r(0, sh / 2),
		colour: ["#90a","#f32","#138"][coin-3]
	};
}

render = t => {
	requestAnimationFrame(render);
	c.clearRect(0,0,sw,sh)

	p = {x: t * 0.1 % sw, y: sh - 60, r: 40};

	distance = (b,o) => {
		dx = b.x - o.x;
		dy = b.y - o.y;
		d = Math.sqrt( dx * dx + dy * dy ) + 1/1e5;
		return {dx,dy,d}
	}

	v.map((b,i)=>{
		if (distance(b, p).d < p.r) {
			// con.log("kill")
		}
	  	v.slice(i).map((o,j)=>{
	  //for(j=i+1;j++<objs;){o=v[j] // for loop is 2 chrs more than slice&map
	  		var {dx,dy,d} = distance(b, o);
			r = b.r + o.r;
			if (d < r) { // bounce time
				m = r / d * 10;
				ux = m * dx / d;
				uy = m * dy / d;

				b.mx += ux / b.r;
				b.my += uy / b.r;

				o.mx -= ux / o.r;
				o.my -= uy / o.r;
			}

		});

		b.mx *= fric;
		b.my += .1; // gravity
		b.my *= fric;

		c.fillStyle = b.colour;
		c.beginPath();
		c.arc(b.x, b.y, b.r, 0, Math.PI * 2, false);
		c.fill();
	});

	v.map(b => {
		if ( b.x < b.r ) b.mx = abs(b.mx);
		if ( b.x > sw - b.r ) b.mx = -abs(b.mx);
		if ( b.y > sh - b.r ) b.my = -abs(b.my); // bouncey coins
		b.mmx -= (b.mmx - b.mx) * .7;
		b.mmy -= (b.mmy - b.my) * .7;
		b.x += b.mmx;
		b.y += b.mmy;
	});



	c.fillStyle = "yellow";
	c.beginPath();
	c.arc(p.x, p.y, p.r, 0, Math.PI * 2, false);
	c.fill();


}
render();

</script>
